---
typora-copy-images-to: upload
---

# MySQL-sql编程

1. mysql数据库

   1. 数据库应用类型

      1. OLTP

         是传统关系型数据库的主要应用，其主要面向基本的、日常的事务处理。

      2. OLAP

         是数据仓库系统的主要应用，支持复杂的分析操作，侧重决策支持，并且提供直观易懂的查询结果。

   2. OLTP

      OLTP也被称为面向交易的处理系统，其基本特征是可以立即将顾客的原始数据传送到计算中心管进行处理，并在很短的时间内给出处理结果，这个过程的最大优点是可以即时的处理输入的数据，及时地回答，因此OLTP又被称为实时系统。衡量OLTP系统的一个重要性能指标是系统性能，具体体现为实时响应时间。OLTP数据库旨在事务应用程序仅完成对所需数据的写入，以便尽快处理单个事务。

      1. 特征
         - 支持大量并发用户定期添加和修改数据。
         - 反映随时变化的单位状态，但不保存其历史记录。
         - 包含大量数据，其中包括用于验证事务的大量数据。
         - 具有复杂的结构。
         - 可以进行优化以对事务活动做出响应。
         - 提供用于支持单位日常运营的技术基础结构。
         - 个别事务能够很快地完成，并且只需要访问相对较少的数据。OLTP系统旨在出库同时输入的成百上千的事务。

   3. OLAP

      OLAP是一种用于组织大型商务数据库和支持商务智能的技术。OLAP数据库分为一个或多个多维数据集，每个多维数据集都由多维数据集管理员组织设计，以适应与用户检索和分析数据的方式，从而更易于创建和使用所需的数据透视表和数据透视图。OLAP具有灵活的分析功能、直观的数据操作和分析结果可视化表示等优点，从而使用户对基于大量复杂数据的分析变得轻松而高效，利于用户迅速做出判断。

      1. 基本概念

         维：是用户观察数据的特定角度，是问题的一类属性，属性集合构成一个维。

         维的层次：用户观察数据的某个特定角度，还可能存在细节程度不同的各个描述方面。

         维的成员：即维的一个取值，是数据项在某个维中的位置的描述，如”某年某月某日“是在时间维上的位置描述。

         度量：多维数组的取值。

   4. OLTP和OLAP的比较

      1. OLTP特点一般有：

         - 实时性要求高。
         - 查询的数据量不是很大。
         - 交易一般是确定的，所以OLTP是对确定性的数据进行存取。
         - 并发性要求高，并且严格要求事务的完整性、安全性。

      2. OLAP特点一般有：

         - 实时性要求不是很高，很多应用最多每天更新一次数据。
         - 数据量大。因为OLAP支持的是动态查询，用户要通过对很多数据的统计才能得到想要知道的信息，如时间序列分析等，所以处理的数据量很大。
         - 因为重点在于决策支持，所以查询一般是动态的，也就是说允许用户随时提出查询的要求。因此，在OLAP中通过一个重要概念”维“来搭建一个动态查询的平台，供用户自己决定需要知道的信息。

         |          | OLTP            | OLAP           |
         | -------- | --------------- | -------------- |
         | 用户     | 操作人员        | 决策人员       |
         | 功能     | 日常操作处理    | 分析决策       |
         | DB设计   | 面向应用        | 面向主题       |
         | 数据     | 当前的，最新的  | 历史的，聚集的 |
         | 存取     | 读/写数十条记录 | 读上百万的数据 |
         | 工作单位 | 简单事务        | 复杂查询       |
         | 用户数   | 上千个          | 上百个         |
         | DB大小   | 一般小于500G    | 大于1T         |

      3. MySQL存储引擎及其面向的数据库应用

         1. 组成

            - 连接池组件(Connection Pool)
            - 管理服务和组件(Management Servcie &Utilities)
            - SQL接口组件(SQL Interface)
            - 查询分析器组件(Parser)
            - 优化器组件(Optimzer)
            - 缓冲组件(Caches & Buffers)
            - 插件式存储引擎(Pluggable Storage Engines)
            - 物理文件(File System)

            ![image-20220106165230977](https://raw.githubusercontent.com/ZJL2019/picGo/main/img/202201121521430.png)

             sql解析器、sql优化器、缓冲池、存储引擎等组件在每个数据库中都存在，但是并不是每个数据库都有这么多的存储引擎。MySQL的插件式存储引擎可以让存储引擎层的开发人员设计他们希望的存储层。
         
         2. InnoDB存储引擎
           
            支持事务，其设计目标主要面向联机事务处理(OLTP)的应用。
            
            特点：
            
            - 行锁设计
            - 支持外键
            - 类似Oracle的非锁定读，即，默认读取操作不会产生锁。
            
            InnoDB存储引擎将数据放在一个逻辑的表空间中，这个表空间和黑盒一样由InnoDB存储引擎自身来管理。 可以将每个InnoDB存储引擎的表单独存放到一个独立的ibd文件中，此外InnoDB存储引擎支持将裸设备用于建立其表空间。
            
            InnoDB通过使用多版本并发控制(MVCC)来获得高并发性，并且实现了SQL标准的4种隔离级别，默认为REPEATABLE级别，同时使用一种称为netx-key locking的策略来避免幻读现象的产生，还提供了缓冲、二次写、自适应哈希索引、预读等高性能和高可用的功能。对于表中数据的存储，InnoDB存储引擎采用了聚集的方式，每张表都是按照主键的顺序进行存储的，如果没有显示的在表定义时指定主键，InnoDB存储引擎会为每一行生成一个6个字节的ROWID，并以此作为主键。
         
         3. MyISAM存储引擎
         
            不支持事务、表锁设计、支持全文索引，主要面向OLAP数据库应用
         
         4. NDB存储引擎
         
            NDB存储引擎是一个集群存储引擎，类似于Oracle的RAC集群。不过Oracle RAC的share everything结构不同的是，其结构是share nothing的集群架构，因此可以提供更高级别的高可用性。NDB存储引擎的特点是数据全部放在内存中，因此注解查找的速度极快，并且能够在线添加NDB数据存储节点以便线性地提高数据库性能。NDB存储引擎是高可用、高性能、高可扩展性的数据库集群系统，其面向也是OLTP数据库应用。
         
         5. Memory存储引擎
         
            Memory存储引擎中的数据都存放在内存中，数据库重启或者发生崩溃，表中的数据都会消失。非常适合OLTP的临时数据存放，默认使用哈希索引而不是B+树索引。
         
         6. Infobright存储引擎
         
            第三方存储引擎，其特点是存储按照列而非行，适合OLAP。
         
         7. NTSE存储引擎
         
            网易开发的内部存储引擎。目前不支持事务，支持压缩、行级缓存等。
   
2. 数据类型
   
   1. 类型属性
   
      1. UNSIGNED
   
         将数字类型无符号化
   
         ```sql
         create table t (a int unsigned, b int unsigned) engine=innodb;
         ```
   
         在mysql数据库中对unsigned树操作，返回值都是unsigned的。
   
      2. ZEROFILL
   
         更像是一个显示的属性。如果宽度小于设定的宽度，则自动填充0
   
   2. SQL_MODE
   
      默认为空，可以允许一些非法操作。如：将null插入not null的字段中，也可以插入一些非法日期。
   
      模式：
   
      - STRICT_TRANS_TABLES：在该模式下，如果一个值不能插入到一个事务表中，则中断当前的操作不影响非事务表。
   
      - ALLOW_INVALID_DATES：该选项并不完全对日期的合法性进行检查。只检查月份是否在1~12之间，日期是否在1~31之间，该模式仅对DTAE和DATETIME类型有效，对TIMESTAMP无效
   
      - ANSI_QUOTES：不能用双引号来引用字符，因为它将被解释为标识符。
   
      - ERROE_FOR_DIVISION_BY_ZERO：在insert或update过程中，如果数据被0除，则产生错误。如果未给出该模式，则返回NULL。
   
      - HIGH_NOT_PRECEDENCE NOT：操作符的优先顺序是表达式。
   
        ····
   
   3. 日期和时间类型
   
      | 类型      | 所占空间/字节 |
      | --------- | ------------- |
      | datetime  | 8             |
      | date      | 3             |
      | timestamp | 4             |
      | year      | 1             |
      | time      | 3             |
   
      1. datetime和date
   
         datetime占用8个字节，是占用空间最多的一种日期类型
   
         date占用3个字节，不显示时间，只显示年月日
   
         type_name(fsp)支持微秒
   
         其中type_name可以是time、datetime、timestamp，fsp表示支持微秒的精度，最大为6
   
      2. 与日期和时间相关的函数
   
         - now、current_timestamp、sysdate(执行当前函数的时间)
   
         - date_add、date_sub
   
           ```sql
           date_add(now(),interval 1 day)
           ```
   
   4. 数字类型
   
   5. 数字的经典SQL编程问题
   
   6. 字符类型 
   
2. 查询处理
   
   1. 逻辑查询处理
   
      在大多数代码中，代码按照编码顺序处理，在sql中，第一个被处理的总是from子句。
   
      <img src="https://raw.githubusercontent.com/ZJL2019/picGo/main/img/202201121521431.png" alt="image-20220106182817982" style="zoom:50%;" />
   
      1. 执行笛卡尔积
      2. 应用on过滤器
      3. 添加外部行
      4. 应用where过滤器
      5. 分组
      6. 应用rollup|cube
      7. 应用having过滤器
      8. 处理select列表
      9. 应用distinct子句
      10. 应用order by子句
      11. limit子句
   
   2. 物理查询处理